<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è±è±ç”Ÿæ—¥å¿«ä¹ - æ¸©é¦¨ç‰ˆ</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            background: #FFF8DC;
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            color: #8B4513;
            overflow-x: hidden;
            min-height: 100vh;
        }
        
        .hidden { display: none !important; }
        
        /* åŠ è½½å±å¹• */
        .loading-screen {
            height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: #FFF8DC;
            position: relative;
        }
        
        .loading-content { text-align: center; z-index: 1; }
        
        .loading-title {
            font-size: 3rem;
            font-weight: 300;
            margin-bottom: 3rem;
            line-height: 1.2;
            color: #FF69B4;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }
        
        .title-line {
            display: block;
            margin-bottom: 0.5rem;
            opacity: 0;
            animation: fadeInUp 1s ease forwards;
        }
        
        .title-line:nth-child(1) { animation-delay: 0.5s; }
        .title-line:nth-child(2) { animation-delay: 1s; }
        
        /* è¿›åº¦æ¡ */
        .progress-container {
            width: 300px;
            height: 8px;
            background: rgba(255, 105, 180, 0.2);
            border-radius: 20px;
            overflow: hidden;
            margin-top: 2rem;
        }
        
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #FF69B4, #FF1493);
            border-radius: 20px;
            width: 0%;
            transition: width 0.3s ease;
            animation: progressGlow 2s ease-in-out infinite;
        }
        
        .progress-text {
            margin-top: 1rem;
            font-size: 1.2rem;
            color: #FF69B4;
            opacity: 0;
            animation: fadeIn 1s ease forwards 1.5s;
        }
        
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes progressGlow {
            0%, 100% { box-shadow: 0 0 5px rgba(255, 105, 180, 0.3); }
            50% { box-shadow: 0 0 20px rgba(255, 105, 180, 0.6); }
        }
        
        /* ä¸»å†…å®¹ */
        .main-content {
            min-height: 100vh;
            background: #FFF8DC;
            padding: 2rem;
            position: relative;
        }
        
        .controls-header {
            position: fixed;
            top: 1rem;
            right: 1rem;
            display: flex;
            gap: 1rem;
            z-index: 100;
        }
        
        .control-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: none;
            background: rgba(255, 105, 180, 0.8);
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .control-btn:hover {
            background: rgba(255, 105, 180, 1);
            transform: scale(1.1);
        }
        
        .birthday-content {
            max-width: 800px;
            margin: 0 auto;
            text-align: center;
            padding-top: 5rem;
        }
        
        .main-title {
            font-size: 4rem;
            margin-bottom: 2rem;
            color: #FF69B4;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
            opacity: 0;
            transform: translateY(50px);
        }
        
        .subtitle {
            font-size: 2rem;
            margin-bottom: 3rem;
            color: #FF1493;
            opacity: 0;
            transform: translateY(50px);
        }
        
        .cake-section {
            margin: 3rem 0;
            font-size: 5rem;
            opacity: 0;
            transform: scale(0.5);
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .cake-gif {
            max-width: 300px;
            max-height: 300px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .simple-cake {
            font-size: 5rem;
            text-align: center;
            filter: drop-shadow(0 4px 8px rgba(0,0,0,0.2));
            animation: cakeGlow 2s ease-in-out infinite alternate;
        }
        
        @keyframes cakeGlow {
            0% { filter: drop-shadow(0 4px 8px rgba(0,0,0,0.2)) brightness(1); }
            100% { filter: drop-shadow(0 4px 15px rgba(255,105,180,0.3)) brightness(1.1); }
        }
        
        .wishes-text {
            font-size: 1.2rem;
            line-height: 2;
            color: #8B4513;
            margin: 2rem 0;
            padding: 2rem;
            background: rgba(255, 255, 255, 0.6);
            border-radius: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            opacity: 0;
            transform: translateY(30px);
        }
        
        .wishes-text p {
            margin: 1rem 0;
            opacity: 0;
            transform: translateX(-50px);
        }
        
        /* èƒŒæ™¯è£…é¥° */
        .background-decorations {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }
        
        .balloon {
            position: absolute;
            font-size: 2rem;
            cursor: pointer;
            pointer-events: auto;
            transition: transform 0.3s ease;
            animation: float 3s ease-in-out infinite;
            opacity: 0;
            transform: translateY(100px);
        }
        
        .balloon:hover { transform: scale(1.2); }
        
        .star {
            position: absolute;
            font-size: 1rem;
            cursor: pointer;
            pointer-events: auto;
            animation: twinkle 2s infinite;
            opacity: 0;
            transform: scale(0);
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(-5deg); }
            50% { transform: translateY(-20px) rotate(5deg); }
        }
        
        @keyframes twinkle {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }
        
        @keyframes slideInUp {
            from { opacity: 0; transform: translateY(50px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes slideInLeft {
            from { opacity: 0; transform: translateX(-50px); }
            to { opacity: 1; transform: translateX(0); }
        }
        
        @keyframes scaleIn {
            from { opacity: 0; transform: scale(0.5); }
            to { opacity: 1; transform: scale(1); }
        }
        
        @keyframes balloonAppear {
            from { opacity: 0; transform: translateY(100px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes starAppear {
            from { opacity: 0; transform: scale(0); }
            to { opacity: 1; transform: scale(1); }
        }
        
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }
        
        /* ç§»åŠ¨ç«¯ä¼˜åŒ– */
        @media (max-width: 768px) {
            .loading-title { font-size: 2rem; }
            .main-title { font-size: 2.5rem; }
            .subtitle { font-size: 1.3rem; }
            .cake-section { font-size: 3rem; }
            .wishes-text { font-size: 1rem; padding: 1.5rem; }
            .memory-container { padding: 1rem; }
            .lottery-container { padding: 1rem; }
            
            .cake-container { gap: 0.5rem; }
            .candles-container { gap: 0.5rem; margin-top: -1rem; }
            .candle { font-size: 1.5rem; }
            
            .make-wish-btn {
                padding: 0.8rem 1.5rem;
                font-size: 1.1rem;
            }
            
            .control-btn {
                width: 45px;
                height: 45px;
                font-size: 1rem;
            }
            
            .music-player {
                padding: 0.8rem;
                font-size: 0.9rem;
                bottom: 1rem;
                left: 1rem;
            }
            
            .volume-slider { width: 80px; }
        }
        
        /* è§¦æ‘¸ä¼˜åŒ– */
        .balloon, .star, .control-btn, .nav-btn {
            touch-action: manipulation;
            user-select: none;
            -webkit-user-select: none;
            -webkit-touch-callout: none;
        }
        
        /* é¡µé¢å¯¼èˆªæŒ‰é’® */
        .page-nav-buttons {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 999;
            display: flex;
            gap: 1rem;
        }
        
        .nav-btn {
            padding: 1rem 2rem;
            font-size: 1.2rem;
            font-weight: bold;
            color: white;
            background: linear-gradient(45deg, #FF69B4, #FFB6C1);
            border: none;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 6px 20px rgba(255, 105, 180, 0.4);
            transition: all 0.3s ease;
            min-width: 150px;
        }
        
        .nav-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(255, 105, 180, 0.6);
        }
        
        .nav-btn:active {
            transform: translateY(0);
        }
        
        .prev-btn {
            background: linear-gradient(45deg, #87CEEB, #B0E0E6);
            box-shadow: 0 6px 20px rgba(135, 206, 235, 0.4);
        }
        
        .prev-btn:hover {
            box-shadow: 0 8px 25px rgba(135, 206, 235, 0.6);
        }
        
        @media (max-width: 768px) {
            .page-nav-buttons {
                bottom: 20px;
                flex-direction: column;
                align-items: center;
                gap: 0.8rem;
            }
            
            .nav-btn {
                padding: 0.8rem 1.5rem;
                font-size: 1rem;
                min-width: 120px;
            }
        }
        
        /* é¡µé¢å¯¼èˆªæ ·å¼å·²ç§»é™¤ */
        
        @media (hover: none) and (pointer: coarse) {
            .balloon:active, .star:active {
                transform: scale(1.3);
            }
            
            .control-btn:active, .nav-btn:active {
                transform: scale(0.95);
            }
        }
        
        /* éŸ³ä¹æ’­æ”¾å™¨ */
        .music-player {
            position: fixed;
            bottom: 2rem;
            left: 2rem;
            background: rgba(255, 255, 255, 0.8);
            padding: 1rem;
            border-radius: 15px;
            display: flex;
            align-items: center;
            gap: 1rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            opacity: 0;
        }
        
        .player-btn {
            background: #FF69B4;
            border: none;
            color: white;
            padding: 0.5rem;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1rem;
        }
        
        .volume-slider { width: 100px; }
        
        /* åŠ¨ç”»ç±» */
        .animate-in {
            animation: slideInUp 0.8s ease forwards;
        }
        
        .animate-cake {
            animation: scaleIn 0.8s ease forwards;
        }
        
        .animate-wishes {
            animation: slideInUp 0.8s ease forwards;
        }
        
        .animate-wish-line {
            animation: slideInLeft 0.6s ease forwards;
        }
        
        .animate-balloon {
            animation: balloonAppear 0.8s ease forwards;
        }
        
        .animate-star {
            animation: starAppear 0.6s ease forwards;
        }
        
        .animate-player {
            animation: fadeIn 0.8s ease forwards;
        }
    </style>
</head>
<body>
    <!-- åŠ è½½å±å¹• -->
    <section id="loading-screen" class="loading-screen">
        <div class="loading-content">
            <h1 class="loading-title">
                <span class="title-line">è±è±çš„ä¸“å±</span>
                <span class="title-line">ç”Ÿæ—¥ç¥ç¦</span>
            </h1>
            <div class="progress-container">
                <div id="progress-bar" class="progress-bar"></div>
            </div>
            <div class="progress-text">æ­£åœ¨ä¸ºæ‚¨å‡†å¤‡æƒŠå–œ...</div>
        </div>
    </section>

    <!-- é¡µé¢å¯¼èˆªæŒ‰é’® -->
    <div class="page-nav-buttons" id="nav-buttons" style="display: none; opacity: 0;">
        <button class="nav-btn next-btn" onclick="goToNextPage()">
            ğŸ“¸ æŸ¥çœ‹å›å¿† â†’
        </button>
    </div>
    
    <!-- æµ‹è¯•æŒ‰é’®å·²ç§»é™¤ -->

    <!-- å¯¼èˆªèœå•å·²ç§»é™¤ -->

    <!-- ä¸»è¦å†…å®¹åŒºåŸŸ -->
    <section id="main-content" class="main-content hidden">
        <!-- ç²’å­ç‰¹æ•ˆç”»å¸ƒ -->
        <canvas id="particles-canvas" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: -1;"></canvas>
        
        <!-- èƒŒæ™¯è£…é¥°å±‚ -->
        <div class="background-decorations">
            <div id="balloons-container"></div>
            <div id="stars-container"></div>
        </div>

        <!-- é¡¶éƒ¨æ§åˆ¶åŒº -->
        <header class="controls-header">
            <button id="music-toggle" class="control-btn" title="éŸ³ä¹å¼€å…³">ğŸµ</button>
        </header>

        <!-- ä¸»è¦ç¥ç¦å†…å®¹ -->
        <div class="birthday-content">
            <h1 id="main-title" class="main-title">äº²çˆ±çš„è±è±</h1>
            <h2 id="subtitle" class="subtitle">ç”Ÿæ—¥å¿«ä¹ ğŸ‚ 7.21</h2>

            <!-- ç”Ÿæ—¥è›‹ç³• -->
            <section id="cake-section" class="cake-section">
                <img id="cake-gif" class="cake-gif" src="assets/images/birthday-cake.gif" alt="ç”Ÿæ—¥è›‹ç³•" style="display: none;">
                <div id="emoji-cake" class="simple-cake">
                    ğŸ‚ğŸ•¯ï¸âœ¨
                </div>
            </section>

            <!-- ç¥ç¦æ–‡å­— -->
            <div id="wishes-text" class="wishes-text">
                <p id="wish-1">ğŸŒŸ åœ¨è¿™ä¸ªç‰¹åˆ«çš„æ—¥å­é‡Œï¼Œæ„¿ä½ è¢«æ»¡æ»¡çš„çˆ±æ„åŒ…å›´</p>
                <p id="wish-2">ğŸ’– æ„¿ä½ çš„æ¯ä¸€å¤©éƒ½åƒä»Šå¤©ä¸€æ ·é—ªé—ªå‘å…‰</p>
                <p id="wish-3">ğŸˆ æ„¿æ‰€æœ‰çš„ç¾å¥½éƒ½å¦‚æœŸè€Œè‡³</p>
                <p id="wish-4">ğŸ æ„¿ä½ æ°¸è¿œä¿æŒé‚£é¢—çº¯çœŸå¿«ä¹çš„å¿ƒ</p>
                <p id="wish-5">ğŸŒˆ ç”Ÿæ—¥å¿«ä¹ï¼Œæˆ‘æœ€çˆ±çš„è±è±ï¼</p>
            </div>
        </div>

        <!-- éŸ³ä¹æ’­æ”¾å™¨ -->
        <div id="music-player" class="music-player">
            <button id="play-pause-btn" class="player-btn">â¸ï¸</button>
            <span>ç”Ÿæ—¥éŸ³ä¹</span>
            <input type="range" id="volume-slider" class="volume-slider" min="0" max="1" step="0.1" value="0.4">
        </div>
    </section>

    <!-- éŸ³é¢‘å…ƒç´  -->
    <audio id="background-music" preload="auto" loop autoplay></audio>

    <script>
        // å…¨å±€å¯¼èˆªå‡½æ•°
        function goToNextPage() {
            console.log('ğŸ¯ ç‚¹å‡»äº†æŸ¥çœ‹å›å¿†æŒ‰é’®ï¼Œå‰å¾€memory-photos.html');
            window.location.href = 'memory-photos.html';
        }

        // å®Œæ•´çš„ç”Ÿæ—¥é¡µé¢è„šæœ¬
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ‚ è±è±ç”Ÿæ—¥ç¥ç¦é¡µé¢å¼€å§‹åŠ è½½...');
            
            const elements = {
                loadingScreen: document.getElementById('loading-screen'),
                mainContent: document.getElementById('main-content'),
                progressBar: document.getElementById('progress-bar'),
                balloonsContainer: document.getElementById('balloons-container'),
                starsContainer: document.getElementById('stars-container'),
                backgroundMusic: document.getElementById('background-music'),
                musicToggle: document.getElementById('music-toggle'),
                lightsToggle: document.getElementById('lights-toggle'),
                musicPlayer: document.getElementById('music-player')
            };

            // éŸ³é¢‘æ–‡ä»¶è®¾ç½®
            if (elements.backgroundMusic) {
                elements.backgroundMusic.src = 'assets/audio/happy-birthday.mp3';
                elements.backgroundMusic.volume = 0.4; // èƒŒæ™¯éŸ³ä¹é»˜è®¤40%
                
                // æ·»åŠ éŸ³é¢‘äº‹ä»¶ç›‘å¬ç”¨äºè°ƒè¯•
                elements.backgroundMusic.addEventListener('loadeddata', () => {
                    console.log('ğŸµ éŸ³é¢‘æ–‡ä»¶åŠ è½½æˆåŠŸï¼Œæ—¶é•¿:', Math.round(elements.backgroundMusic.duration), 'ç§’');
                });
                elements.backgroundMusic.addEventListener('error', (e) => {
                    console.error('âŒ éŸ³é¢‘æ–‡ä»¶åŠ è½½å¤±è´¥:', e);
                });
                elements.backgroundMusic.addEventListener('play', () => {
                    console.log('ğŸµ èƒŒæ™¯éŸ³ä¹å¼€å§‹æ’­æ”¾');
                });
                elements.backgroundMusic.addEventListener('pause', () => {
                    console.log('â¸ï¸ èƒŒæ™¯éŸ³ä¹æš‚åœ');
                });
            }

            // æ£€æµ‹å¹¶è®¾ç½®è›‹ç³•æ˜¾ç¤ºï¼ˆGIFä¼˜å…ˆï¼Œå¦åˆ™emojiï¼‰
            setupCakeDisplay();

            // åˆå§‹åŒ–ç²’å­ç³»ç»Ÿ
            initParticleSystem();

            // åˆå§‹åŒ–ç§»åŠ¨ç«¯åŠŸèƒ½
            initMobileFeatures();

            // è¿›åº¦æ¡åŠ è½½åŠ¨ç”»
            let progress = 0;
            const progressInterval = setInterval(() => {
                progress += Math.random() * 15 + 5;
                if (progress >= 100) {
                    progress = 100;
                    clearInterval(progressInterval);
                    setTimeout(() => {
                        startBirthdayExperience();
                    }, 500);
                }
                elements.progressBar.style.width = progress + '%';
            }, 300);

            function startBirthdayExperience() {
                console.log('ğŸš€ å¼€å§‹è±è±çš„ç”Ÿæ—¥ä½“éªŒ');
                
                // éšè—åŠ è½½å±å¹•ï¼Œæ˜¾ç¤ºä¸»å†…å®¹
                elements.loadingScreen.style.display = 'none';
                elements.mainContent.classList.remove('hidden');
                
                // å°è¯•æ’­æ”¾èƒŒæ™¯éŸ³ä¹
                startBackgroundMusic();
                
                // æ’­æ”¾æ¬¢è¿éŸ³æ•ˆ
                playSound('chime');
                
                // ä¾æ¬¡æ˜¾ç¤ºå†…å®¹
                setTimeout(() => showMainTitle(), 500);
            }

            function startBackgroundMusic() {
                if (!elements.backgroundMusic) return;
                
                // æ£€æµ‹å¾®ä¿¡ç¯å¢ƒ
                const isWeChat = /MicroMessenger/i.test(navigator.userAgent);
                const isWeChatWork = /wxwork/i.test(navigator.userAgent);
                
                // æ£€æŸ¥å„ç§é¢„åŠ è½½çŠ¶æ€
                const isWeChatOptimized = localStorage.getItem('birthdayWeChatOptimized') === 'true';
                const isUltraFastLoaded = localStorage.getItem('birthdayUltraFastLoaded') === 'true';
                const isStageOneLoaded = localStorage.getItem('birthdayStageOneLoaded') === 'true';
                
                if (isWeChat || isWeChatWork) {
                    console.log('ğŸ” æ£€æµ‹åˆ°å¾®ä¿¡ç¯å¢ƒï¼Œä½¿ç”¨å¾®ä¿¡ä¼˜åŒ–ç­–ç•¥');
                    handleWeChatMusic();
                } else if (isUltraFastLoaded || isStageOneLoaded || isWeChatOptimized) {
                    console.log('ğŸš€ æ£€æµ‹åˆ°å¿«é€Ÿé¢„åŠ è½½å®Œæˆï¼Œå³æ—¶æ’­æ”¾éŸ³ä¹');
                    // é¢„åŠ è½½å®Œæˆï¼Œç«‹å³æ’­æ”¾
                    elements.backgroundMusic.play().then(() => {
                        console.log('ğŸµ é¢„åŠ è½½ç”Ÿæ—¥éŸ³ä¹ç«‹å³å¼€å§‹æ’­æ”¾');
                        removeMusicPrompt();
                    }).catch(e => {
                        console.log('é¢„åŠ è½½éŸ³ä¹æ’­æ”¾å¤±è´¥:', e.message);
                        showMusicClickPrompt();
                    });
                } else {
                    // æ²¡æœ‰é¢„åŠ è½½ï¼Œç­‰å¾…ç”¨æˆ·äº¤äº’
                    console.log('â³ æœªæ£€æµ‹åˆ°é¢„åŠ è½½ï¼Œç­‰å¾…ç”¨æˆ·äº¤äº’');
                    showMusicClickPrompt();
                }
                
                // å¯åŠ¨GIFé¢„åŠ è½½ï¼ˆå¦‚æœè¶…çº§å¿«é€Ÿæ¨¡å¼ï¼‰
                if (isUltraFastLoaded || isWeChatOptimized) {
                    startGifPreloading();
                }
            }

            // å¾®ä¿¡ä¸“ç”¨éŸ³ä¹å¤„ç†
            function handleWeChatMusic() {
                console.log('ğŸµ å¾®ä¿¡ç¯å¢ƒï¼šåˆ›å»ºç”¨æˆ·å‹å¥½çš„éŸ³ä¹å¯åŠ¨æ–¹å¼');
                
                // å¾®ä¿¡ç¯å¢ƒä¸‹ï¼Œæ˜¾ç¤ºæ›´å‹å¥½çš„éŸ³ä¹å¯åŠ¨æç¤º
                const musicPrompt = document.createElement('div');
                musicPrompt.id = 'wechat-music-prompt';
                musicPrompt.style.cssText = `
                    position: fixed;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    background: linear-gradient(135deg, #ff6b9d, #ff8e53);
                    color: white;
                    padding: 20px 30px;
                    border-radius: 20px;
                    text-align: center;
                    z-index: 1000;
                    max-width: 90%;
                    font-size: 1.1rem;
                    line-height: 1.5;
                    box-shadow: 0 8px 25px rgba(255, 107, 157, 0.4);
                    backdrop-filter: blur(10px);
                `;
                musicPrompt.innerHTML = `
                    <div style="margin-bottom: 15px;">ğŸµ ç”Ÿæ—¥éŸ³ä¹</div>
                    <div style="font-size: 0.9em; opacity: 0.9; margin-bottom: 20px;">
                        è½»è§¦ä¸‹æ–¹æŒ‰é’®ï¼Œå¼€å¯æ¸©é¦¨çš„ç”Ÿæ—¥ç¥ç¦éŸ³ä¹
                    </div>
                    <button onclick="startWeChatMusic()" style="
                        background: rgba(255,255,255,0.9);
                        color: #ff6b9d;
                        border: none;
                        padding: 12px 25px;
                        border-radius: 25px;
                        font-size: 1em;
                        font-weight: bold;
                        cursor: pointer;
                        box-shadow: 0 4px 15px rgba(0,0,0,0.2);
                        transition: all 0.3s ease;
                    " onmousedown="this.style.transform='scale(0.95)'" 
                       onmouseup="this.style.transform='scale(1)'">
                        ğŸ‰ å¼€å§‹æ’­æ”¾éŸ³ä¹
                    </button>
                `;
                
                document.body.appendChild(musicPrompt);
                
                // å¾®ä¿¡ç¯å¢ƒä¸‹ï¼Œ5ç§’åè‡ªåŠ¨å°è¯•æ’­æ”¾
                setTimeout(() => {
                    if (document.getElementById('wechat-music-prompt')) {
                        console.log('ğŸµ å¾®ä¿¡ç¯å¢ƒï¼š5ç§’åè‡ªåŠ¨å°è¯•æ’­æ”¾éŸ³ä¹');
                        startWeChatMusic();
                    }
                }, 5000);
            }

            // å¾®ä¿¡éŸ³ä¹å¯åŠ¨å‡½æ•°ï¼ˆå…¨å±€ï¼‰
            window.startWeChatMusic = function() {
                console.log('ğŸµ å¾®ä¿¡ç¯å¢ƒï¼šå¼€å§‹æ’­æ”¾ç”Ÿæ—¥éŸ³ä¹');
                
                const prompt = document.getElementById('wechat-music-prompt');
                if (prompt) {
                    prompt.style.opacity = '0';
                    prompt.style.transform = 'translate(-50%, -50%) scale(0.8)';
                    setTimeout(() => prompt.remove(), 300);
                }
                
                if (elements.backgroundMusic) {
                    elements.backgroundMusic.play().then(() => {
                        console.log('ğŸµ å¾®ä¿¡ç¯å¢ƒï¼šç”Ÿæ—¥éŸ³ä¹æ’­æ”¾æˆåŠŸ');
                    }).catch(e => {
                        console.log('ğŸµ å¾®ä¿¡ç¯å¢ƒï¼šéŸ³ä¹æ’­æ”¾å¤±è´¥ï¼Œå°†åœ¨ç”¨æˆ·äº¤äº’åé‡è¯•');
                    });
                }
            };

            // é¢„åŠ è½½ç”Ÿæ—¥è›‹ç³•GIF
            function startGifPreloading() {
                console.log('ğŸ‚ å¼€å§‹åå°é¢„åŠ è½½ç”Ÿæ—¥è›‹ç³•GIF...');
                
                const cakeImg = new Image();
                cakeImg.onload = () => {
                    console.log('âœ… ç”Ÿæ—¥è›‹ç³•GIFåŠ è½½å®Œæˆï¼Œå‡†å¤‡æ˜¾ç¤º');
                    // GIFåŠ è½½å®Œæˆåï¼Œç¡®ä¿cakeå…ƒç´ èƒ½æ­£å¸¸æ˜¾ç¤º
                    const cakeElement = document.querySelector('#cake-gif');
                    if (cakeElement) {
                        // è®¾ç½®GIFæºå¹¶æ˜¾ç¤º
                        cakeElement.src = 'assets/images/birthday-cake.gif';
                        cakeElement.style.display = 'block';
                        
                        // éšè—emojiè›‹ç³•
                        const emojiCake = document.querySelector('#emoji-cake');
                        if (emojiCake) {
                            emojiCake.style.display = 'none';
                        }
                        
                        console.log('ğŸ‚ ç”Ÿæ—¥è›‹ç³•GIFå·²è®¾ç½®åˆ°é¡µé¢å¹¶æ˜¾ç¤º');
                        
                        // æ ‡è®°GIFå·²å‡†å¤‡å°±ç»ª
                        window.gifPreloaded = true;
                    } else {
                        console.warn('âš ï¸ æ‰¾ä¸åˆ°cake-gifå…ƒç´ ');
                    }
                };
                cakeImg.onerror = () => {
                    console.warn('âš ï¸ ç”Ÿæ—¥è›‹ç³•GIFåŠ è½½å¤±è´¥ï¼Œä½¿ç”¨emojiè›‹ç³•');
                    // å¦‚æœGIFåŠ è½½å¤±è´¥ï¼Œç¡®ä¿emojiè›‹ç³•æ˜¾ç¤º
                    const emojiCake = document.querySelector('#emoji-cake');
                    if (emojiCake) {
                        emojiCake.style.display = 'block';
                    }
                    window.gifPreloaded = false;
                };
                cakeImg.src = 'assets/images/birthday-cake.gif';
            }

            // åœ¨åå°é¢„åŠ è½½ç¬¬äºŒé˜¶æ®µèµ„æºï¼ˆå›å¿†é¡µé¢éœ€è¦çš„ï¼‰
            function preloadStageTwo() {
                // æ£€æŸ¥æ˜¯å¦å·²ç»åŠ è½½è¿‡ç¬¬äºŒé˜¶æ®µ
                if (localStorage.getItem('birthdayStageTwo') === 'true') {
                    console.log('âœ… ç¬¬äºŒé˜¶æ®µèµ„æºå·²ç¼“å­˜');
                    return;
                }

                console.log('ğŸ”„ å¼€å§‹åå°é¢„åŠ è½½ç¬¬äºŒé˜¶æ®µèµ„æº (å›å¿†é¡µé¢)...');
                
                const stageTwo = [
                    'assets/images/memories/memory1.jpg',
                    'assets/images/memories/memory2.jpg',
                    'assets/images/memories/memory3.jpg',
                    'assets/images/memories/memory4.jpg',
                    'assets/images/memories/memory5.jpg',
                    'assets/images/memories/memory6.jpg',
                    'assets/images/memories/memory7.jpg',
                    'assets/images/memories/memory8.jpg',
                    'assets/audio/birthday-song.mp3'
                ];

                let loaded = 0;
                const total = stageTwo.length;

                stageTwo.forEach((src, index) => {
                    if (src.endsWith('.jpg')) {
                        const img = new Image();
                        img.onload = img.onerror = () => {
                            loaded++;
                            const progress = Math.round((loaded / total) * 100);
                            console.log(`ğŸ“¸ Stage 2: ${progress}% (${loaded}/${total})`);
                            
                            if (loaded === total) {
                                localStorage.setItem('birthdayStageTwo', 'true');
                                console.log('âœ… ç¬¬äºŒé˜¶æ®µé¢„åŠ è½½å®Œæˆ (å›å¿†é¡µé¢èµ„æº)');
                            }
                        };
                        img.src = src;
                    } else if (src.endsWith('.mp3')) {
                        const audio = new Audio();
                        audio.oncanplaythrough = audio.onerror = () => {
                            loaded++;
                            const progress = Math.round((loaded / total) * 100);
                            console.log(`ğŸµ Stage 2: ${progress}% (${loaded}/${total})`);
                            
                            if (loaded === total) {
                                localStorage.setItem('birthdayStageTwo', 'true');
                                console.log('âœ… ç¬¬äºŒé˜¶æ®µé¢„åŠ è½½å®Œæˆ (å›å¿†é¡µé¢èµ„æº)');
                            }
                        };
                        audio.src = src;
                    }
                });
            }

            function showMusicClickPrompt() {
                // åˆ›å»ºéŸ³ä¹ç‚¹å‡»æç¤º
                const musicPrompt = document.createElement('div');
                musicPrompt.id = 'music-prompt';
                musicPrompt.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: rgba(255, 105, 180, 0.9);
                    color: white;
                    padding: 1rem 1.5rem;
                    border-radius: 25px;
                    font-size: 0.9rem;
                    z-index: 1000;
                    cursor: pointer;
                    animation: fadeIn 0.5s ease, bounce 2s infinite;
                    box-shadow: 0 4px 15px rgba(255, 105, 180, 0.3);
                `;
                musicPrompt.innerHTML = 'ğŸµ ç‚¹å‡»ä»»æ„åœ°æ–¹æ’­æ”¾éŸ³ä¹';
                
                document.body.appendChild(musicPrompt);
                
                // ç‚¹å‡»ä»»æ„åœ°æ–¹æ’­æ”¾éŸ³ä¹
                function tryPlayMusic() {
                    elements.backgroundMusic.play().then(() => {
                        console.log('ğŸµ ç”¨æˆ·äº¤äº’åéŸ³ä¹å¼€å§‹æ’­æ”¾');
                        removeMusicPrompt();
                        // ç§»é™¤æ‰€æœ‰äº‹ä»¶ç›‘å¬å™¨
                        document.removeEventListener('click', tryPlayMusic);
                        document.removeEventListener('touchstart', tryPlayMusic);
                    }).catch(e => console.log('äº¤äº’åæ’­æ”¾å¤±è´¥:', e.message));
                }
                
                // æ·»åŠ å¤šç§äº¤äº’äº‹ä»¶
                document.addEventListener('click', tryPlayMusic, { once: true });
                document.addEventListener('touchstart', tryPlayMusic, { once: true });
                
                // æç¤ºè‡ªåŠ¨æ¶ˆå¤±
                setTimeout(() => {
                    removeMusicPrompt();
                }, 10000);
            }

            function removeMusicPrompt() {
                const prompt = document.getElementById('music-prompt');
                if (prompt) {
                    prompt.remove();
                }
            }

            function showMainTitle() {
                const title = document.getElementById('main-title');
                title.classList.add('animate-in');
                playSound('sparkle');
                setTimeout(() => showSubtitle(), 1000);
            }

            function showSubtitle() {
                const subtitle = document.getElementById('subtitle');
                subtitle.classList.add('animate-in');
                playSound('bell');
                setTimeout(() => showBalloons(), 800);
            }

            function showBalloons() {
                // åˆ›å»ºæ°”çƒ
                for (let i = 0; i < 6; i++) {
                    setTimeout(() => {
                        createBalloon();
                        playSound('pop');
                    }, i * 300);
                }
                setTimeout(() => showCake(), 2000);
            }

            function showCake() {
                const cake = document.getElementById('cake-section');
                cake.classList.add('animate-cake');
                
                // æ£€æŸ¥GIFæ˜¯å¦å·²é¢„åŠ è½½
                if (window.gifPreloaded) {
                    console.log('ğŸ‚ GIFå·²é¢„åŠ è½½ï¼Œæ˜¾ç¤ºGIFè›‹ç³•');
                    const cakeGif = document.querySelector('#cake-gif');
                    const emojiCake = document.querySelector('#emoji-cake');
                    if (cakeGif && emojiCake) {
                        cakeGif.style.display = 'block';
                        emojiCake.style.display = 'none';
                    }
                } else {
                    console.log('ğŸ‚ GIFæœªé¢„åŠ è½½ï¼Œæ˜¾ç¤ºemojiè›‹ç³•');
                    const emojiCake = document.querySelector('#emoji-cake');
                    if (emojiCake) {
                        emojiCake.style.display = 'block';
                    }
                }
                
                playSound('chime');
                setTimeout(() => showStars(), 800);
            }

            function showStars() {
                // åˆ›å»ºæ˜Ÿæ˜Ÿ
                for (let i = 0; i < 12; i++) {
                    setTimeout(() => {
                        createStar();
                        if (i % 3 === 0) playSound('sparkle');
                    }, i * 200);
                }
                setTimeout(() => showWishes(), 1000);
            }

            function showWishes() {
                const wishesContainer = document.getElementById('wishes-text');
                wishesContainer.classList.add('animate-wishes');
                
                // ä¾æ¬¡æ˜¾ç¤ºç¥ç¦è¯­
                for (let i = 1; i <= 5; i++) {
                    setTimeout(() => {
                        const wish = document.getElementById(`wish-${i}`);
                        wish.classList.add('animate-wish-line');
                        playSound('bell');
                    }, i * 600);
                }
                
                // ç¥ç¦è¯­æ˜¾ç¤ºå®Œæˆåæ˜¾ç¤ºå¯¼èˆªæŒ‰é’®
                setTimeout(() => {
                    showNavigationButtons();
                    console.log('ğŸ§­ å†…å®¹å±•ç¤ºå®Œæ¯•ï¼Œæ˜¾ç¤ºå¯¼èˆªæŒ‰é’®');
                }, 4000);
            }

            // showMusicPlayerå‡½æ•°å·²ç§»é™¤ï¼Œæ”¹ä¸ºç›´æ¥æ˜¾ç¤ºå¯¼èˆªæŒ‰é’®

            function createBalloon() {
                const balloon = document.createElement('div');
                balloon.className = 'balloon';
                balloon.innerHTML = ['ğŸˆ', 'ğŸ€', 'ğŸŠ', 'ğŸ‰'][Math.floor(Math.random() * 4)];
                balloon.style.left = Math.random() * 85 + 5 + '%';
                balloon.style.top = Math.random() * 70 + 15 + '%';
                balloon.style.animationDelay = Math.random() * 3 + 's';
                
                // ç«‹å³è®¾ç½®åˆå§‹çŠ¶æ€
                balloon.style.opacity = '0';
                balloon.style.transform = 'translateY(100px)';
                
                balloon.addEventListener('click', function() {
                    playSound('pop');
                    balloon.style.transform = 'scale(1.5)';
                    balloon.style.opacity = '0';
                    setTimeout(() => {
                        balloon.remove();
                        // åˆ›å»ºæ–°æ°”çƒ
                        setTimeout(() => createBalloon(), 2000);
                    }, 300);
                });
                
                elements.balloonsContainer.appendChild(balloon);
                
                // çŸ­æš‚å»¶è¿Ÿåè§¦å‘åŠ¨ç”»
                setTimeout(() => {
                    balloon.classList.add('animate-balloon');
                    console.log('æ°”çƒå·²åˆ›å»ºå¹¶å¼€å§‹åŠ¨ç”»');
                }, 100);
            }

            function createStar() {
                const star = document.createElement('div');
                star.className = 'star';
                star.innerHTML = ['â­', 'âœ¨', 'ğŸŒŸ', 'ğŸ’«'][Math.floor(Math.random() * 4)];
                star.style.left = Math.random() * 95 + '%';
                star.style.top = Math.random() * 95 + '%';
                star.style.animationDelay = Math.random() * 3 + 's';
                
                // ç«‹å³è®¾ç½®åˆå§‹çŠ¶æ€
                star.style.opacity = '0';
                star.style.transform = 'scale(0)';
                
                star.addEventListener('click', function() {
                    playSound('sparkle');
                    star.style.transform = 'scale(1.3)';
                    setTimeout(() => {
                        star.style.transform = 'scale(1)';
                    }, 200);
                });
                
                elements.starsContainer.appendChild(star);
                
                // çŸ­æš‚å»¶è¿Ÿåè§¦å‘åŠ¨ç”»
                setTimeout(() => {
                    star.classList.add('animate-star');
                    console.log('æ˜Ÿæ˜Ÿå·²åˆ›å»ºå¹¶å¼€å§‹åŠ¨ç”»');
                }, 100);
            }

            function playSound(type) {
                try {
                    const audio = new Audio(`assets/audio/effects/${type}.mp3`);
                    audio.volume = 0.1; // éŸ³æ•ˆé»˜è®¤10%ï¼Œæ›´è½»æŸ”
                    audio.play().catch(e => console.log('éŸ³æ•ˆæ’­æ”¾:', e.message));
                } catch (e) {
                    console.log('éŸ³æ•ˆä¸å¯ç”¨');
                }
            }

            // éŸ³ä¹æ§åˆ¶
            if (elements.musicToggle && elements.backgroundMusic) {
                elements.musicToggle.addEventListener('click', function() {
                    if (elements.backgroundMusic.paused) {
                        elements.backgroundMusic.play().then(() => {
                            console.log('ğŸµ ç”Ÿæ—¥éŸ³ä¹å¼€å§‹æ’­æ”¾');
                            removeMusicPrompt(); // ç§»é™¤éŸ³ä¹æç¤º
                        }).catch(e => console.log('éŸ³ä¹æ’­æ”¾å¤±è´¥:', e.message));
                    } else {
                        elements.backgroundMusic.pause();
                        console.log('ğŸµ ç”Ÿæ—¥éŸ³ä¹å·²æš‚åœ');
                    }
                });
            }

            // ç¯å…‰æ§åˆ¶
            if (elements.lightsToggle) {
                elements.lightsToggle.addEventListener('click', function() {
                    document.body.style.background = document.body.style.background === '#F5F5DC' ? '#FFF8DC' : '#F5F5DC';
                    console.log('ğŸ’¡ ç¯å…‰å·²åˆ‡æ¢');
                });
            }

            // éŸ³é‡æ§åˆ¶
            const volumeSlider = document.getElementById('volume-slider');
            if (volumeSlider && elements.backgroundMusic) {
                volumeSlider.addEventListener('input', function() {
                    elements.backgroundMusic.volume = this.value;
                });
            }

            function setupCakeDisplay() {
                const cakeGif = document.getElementById('cake-gif');
                const emojiCake = document.getElementById('emoji-cake');
                
                // åˆ›å»ºä¸€ä¸ªæ–°çš„å›¾ç‰‡å¯¹è±¡æ¥æµ‹è¯•gifæ˜¯å¦å­˜åœ¨
                const testImg = new Image();
                testImg.onload = function() {
                    // GIFåŠ è½½æˆåŠŸï¼Œæ˜¾ç¤ºGIF
                    cakeGif.style.display = 'block';
                    emojiCake.style.display = 'none';
                    console.log('ğŸ‚ è‡ªå®šä¹‰è›‹ç³•GIFåŠ è½½æˆåŠŸ');
                };
                testImg.onerror = function() {
                    // GIFåŠ è½½å¤±è´¥ï¼Œæ˜¾ç¤ºemojiè›‹ç³•
                    cakeGif.style.display = 'none';
                    emojiCake.style.display = 'block';
                    console.log('ğŸ‚ ä½¿ç”¨é»˜è®¤emojiè›‹ç³• (è¯·ä¸Šä¼ birthday-cake.gifåˆ°assets/images/ç›®å½•)');
                };
                testImg.src = 'assets/images/birthday-cake.gif';
            }

            // ç§»é™¤äº†èœ¡çƒ›äº¤äº’å’Œè®¸æ„¿åŠŸèƒ½

            function showNavigationButtons() {
                console.log('ğŸ§­ æ˜¾ç¤ºå¯¼èˆªæŒ‰é’®...');
                const navButtons = document.getElementById('nav-buttons');
                
                if (navButtons) {
                    navButtons.style.display = 'flex';
                    navButtons.style.opacity = '1';
                    navButtons.style.visibility = 'visible';
                    navButtons.style.animation = 'fadeInUp 0.5s ease';
                    console.log('âœ… å¯¼èˆªæŒ‰é’®å·²æ˜¾ç¤º');
                } else {
                    console.error('âŒ æ— æ³•æ‰¾åˆ°å¯¼èˆªæŒ‰é’®å…ƒç´ ');
                }
            }

            // goToNextPageå‡½æ•°å·²ç§»è‡³å…¨å±€ä½œç”¨åŸŸ

            // ç²’å­ç³»ç»Ÿ
            function initParticleSystem() {
                const canvas = document.getElementById('particles-canvas');
                if (!canvas) return;
                
                const ctx = canvas.getContext('2d');
                let particles = [];
                let animationId;
                
                // è®¾ç½®ç”»å¸ƒå¤§å°
                function resizeCanvas() {
                    canvas.width = window.innerWidth;
                    canvas.height = window.innerHeight;
                }
                resizeCanvas();
                window.addEventListener('resize', resizeCanvas);
                
                // ç²’å­ç±»
                class Particle {
                    constructor(x, y, type = 'spark') {
                        this.x = x;
                        this.y = y;
                        this.type = type;
                        this.life = 1.0;
                        this.decay = 0.015 + Math.random() * 0.01;
                        
                        if (type === 'firework') {
                            this.vx = (Math.random() - 0.5) * 8;
                            this.vy = (Math.random() - 0.5) * 8;
                            this.size = 2 + Math.random() * 3;
                            this.color = ['#FF69B4', '#FFD700', '#FF1493', '#FFA500'][Math.floor(Math.random() * 4)];
                        } else if (type === 'heart') {
                            this.vx = (Math.random() - 0.5) * 2;
                            this.vy = 1 + Math.random() * 2;
                            this.size = 3 + Math.random() * 4;
                            this.color = '#FF69B4';
                            this.decay = 0.003;
                        } else if (type === 'bubble') {
                            this.vx = (Math.random() - 0.5) * 1;
                            this.vy = -1 - Math.random() * 2;
                            this.size = 5 + Math.random() * 15;
                            this.color = `rgba(255,105,180,${0.3 + Math.random() * 0.4})`;
                            this.decay = 0.001;
                        }
                        
                        this.gravity = type === 'bubble' ? -0.02 : 0.1;
                        this.friction = 0.98;
                    }
                    
                    update() {
                        this.x += this.vx;
                        this.y += this.vy;
                        this.vy += this.gravity;
                        this.vx *= this.friction;
                        this.vy *= this.friction;
                        this.life -= this.decay;
                        
                        return this.life > 0 && this.x > -50 && this.x < canvas.width + 50 && this.y < canvas.height + 50;
                    }
                    
                    draw() {
                        ctx.save();
                        ctx.globalAlpha = this.life;
                        
                        if (this.type === 'heart') {
                            this.drawHeart();
                        } else if (this.type === 'bubble') {
                            this.drawBubble();
                        } else {
                            this.drawSpark();
                        }
                        
                        ctx.restore();
                    }
                    
                    drawSpark() {
                        ctx.fillStyle = this.color;
                        ctx.beginPath();
                        ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                        ctx.fill();
                        
                        // å‘å…‰æ•ˆæœ
                        ctx.shadowColor = this.color;
                        ctx.shadowBlur = this.size * 2;
                        ctx.fill();
                    }
                    
                    drawHeart() {
                        const size = this.size;
                        ctx.fillStyle = this.color;
                        ctx.beginPath();
                        ctx.font = `${size}px Arial`;
                        ctx.textAlign = 'center';
                        ctx.fillText('ğŸ’–', this.x, this.y);
                    }
                    
                    drawBubble() {
                        const gradient = ctx.createRadialGradient(this.x, this.y, 0, this.x, this.y, this.size);
                        gradient.addColorStop(0, this.color);
                        gradient.addColorStop(0.7, this.color.replace(/[\d\.]+\)$/g, '0.1)'));
                        gradient.addColorStop(1, 'transparent');
                        
                        ctx.fillStyle = gradient;
                        ctx.beginPath();
                        ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                        ctx.fill();
                        
                        // é«˜å…‰
                        ctx.fillStyle = 'rgba(255,255,255,0.6)';
                        ctx.beginPath();
                        ctx.arc(this.x - this.size * 0.3, this.y - this.size * 0.3, this.size * 0.3, 0, Math.PI * 2);
                        ctx.fill();
                    }
                }
                
                // åˆ›å»ºçƒŸèŠ±
                function createFirework(x, y) {
                    const sparkCount = 15 + Math.random() * 10;
                    for (let i = 0; i < sparkCount; i++) {
                        particles.push(new Particle(x, y, 'firework'));
                    }
                    console.log('ğŸ’¥ çƒŸèŠ±çˆ†ç‚¸:', x, y);
                }
                
                // åˆ›å»ºçˆ±å¿ƒé›¨
                function createHeartRain() {
                    for (let i = 0; i < 8; i++) {
                        const x = Math.random() * canvas.width;
                        const y = -50;
                        particles.push(new Particle(x, y, 'heart'));
                    }
                    console.log('ğŸ’• çˆ±å¿ƒé›¨');
                }
                
                // åˆ›å»ºæ°”æ³¡
                function createBubbles() {
                    for (let i = 0; i < 3; i++) {
                        const x = Math.random() * canvas.width;
                        const y = canvas.height + 20;
                        particles.push(new Particle(x, y, 'bubble'));
                    }
                }
                
                // åŠ¨ç”»å¾ªç¯
                function animate() {
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    
                    particles = particles.filter(particle => {
                        const isAlive = particle.update();
                        if (isAlive) {
                            particle.draw();
                        }
                        return isAlive;
                    });
                    
                    animationId = requestAnimationFrame(animate);
                }
                
                // å¯åŠ¨åŠ¨ç”»
                animate();
                
                // å®šæœŸåˆ›å»ºæ°”æ³¡
                setInterval(createBubbles, 4000);
                
                // é¡µé¢ç‚¹å‡»åˆ›å»ºçƒŸèŠ±
                document.addEventListener('click', function(e) {
                    if (e.target.tagName !== 'BUTTON' && e.target.tagName !== 'INPUT') {
                        createFirework(e.clientX, e.clientY);
                    }
                });
                
                // æš´éœ²å‡½æ•°åˆ°å…¨å±€
                window.createHeartRain = createHeartRain;
                window.createFirework = createFirework;
                
                console.log('âœ¨ ç²’å­ç³»ç»Ÿåˆå§‹åŒ–å®Œæˆ');
            }

            // ç§»åŠ¨ç«¯åŠŸèƒ½å¢å¼º
            function initMobileFeatures() {
                const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
                const isTouch = 'ontouchstart' in window;
                
                if (isMobile || isTouch) {
                    console.log('ğŸ“± ç§»åŠ¨ç«¯è®¾å¤‡æ£€æµ‹åˆ°');
                    
                    // æ·»åŠ ç§»åŠ¨ç«¯CSSç±»
                    document.body.classList.add('mobile-device');
                    
                    // è§¦æ‘¸æ‰‹åŠ¿æ”¯æŒ
                    initTouchGestures();
                    
                    // è®¾å¤‡æ–¹å‘æ£€æµ‹
                    initOrientationDetection();
                    
                    // ç§»åŠ¨ç«¯æ€§èƒ½ä¼˜åŒ–
                    optimizeForMobile();
                    
                    // é˜²æ­¢åŒå‡»ç¼©æ”¾
                    preventDoubleClickZoom();
                    
                    // è§¦æ‘¸åé¦ˆ
                    initTouchFeedback();
                }
            }

            function initTouchGestures() {
                let touchStartX = 0;
                let touchStartY = 0;
                let touchEndX = 0;
                let touchEndY = 0;
                
                document.addEventListener('touchstart', function(e) {
                    touchStartX = e.changedTouches[0].screenX;
                    touchStartY = e.changedTouches[0].screenY;
                }, { passive: true });
                
                document.addEventListener('touchend', function(e) {
                    touchEndX = e.changedTouches[0].screenX;
                    touchEndY = e.changedTouches[0].screenY;
                    handleGesture();
                }, { passive: true });
                
                function handleGesture() {
                    const deltaX = touchEndX - touchStartX;
                    const deltaY = touchEndY - touchStartY;
                    const minSwipeDistance = 50;
                    
                    if (Math.abs(deltaX) > Math.abs(deltaY)) {
                        // æ°´å¹³æ»‘åŠ¨
                        if (Math.abs(deltaX) > minSwipeDistance) {
                            if (deltaX > 0) {
                                console.log('ğŸ‘† å‘å³æ»‘åŠ¨');
                                // å¯ä»¥æ·»åŠ å‘å³æ»‘åŠ¨çš„åŠŸèƒ½
                            } else {
                                console.log('ğŸ‘† å‘å·¦æ»‘åŠ¨');
                                // å¯ä»¥æ·»åŠ å‘å·¦æ»‘åŠ¨çš„åŠŸèƒ½
                            }
                        }
                    } else {
                        // å‚ç›´æ»‘åŠ¨
                        if (Math.abs(deltaY) > minSwipeDistance) {
                            if (deltaY > 0) {
                                console.log('ğŸ‘† å‘ä¸‹æ»‘åŠ¨');
                                // åˆ›å»ºèŠ±ç“£é£˜è½æ•ˆæœ
                                if (window.createHeartRain) {
                                    window.createHeartRain();
                                }
                            } else {
                                console.log('ğŸ‘† å‘ä¸Šæ»‘åŠ¨');
                                // åˆ›å»ºæ°”æ³¡ä¸Šå‡æ•ˆæœ
                                if (window.createFirework) {
                                    window.createFirework(window.innerWidth / 2, window.innerHeight / 2);
                                }
                            }
                        }
                    }
                }
                
                console.log('ğŸ‘† è§¦æ‘¸æ‰‹åŠ¿å·²åˆå§‹åŒ–');
            }

            function initOrientationDetection() {
                function handleOrientationChange() {
                    setTimeout(() => {
                        const canvas = document.getElementById('particles-canvas');
                        if (canvas) {
                            canvas.width = window.innerWidth;
                            canvas.height = window.innerHeight;
                        }
                        console.log('ğŸ“± å±å¹•æ–¹å‘å·²æ”¹å˜');
                    }, 500);
                }
                
                window.addEventListener('orientationchange', handleOrientationChange);
                window.addEventListener('resize', handleOrientationChange);
                
                console.log('ğŸ“± è®¾å¤‡æ–¹å‘æ£€æµ‹å·²åˆå§‹åŒ–');
            }

            function optimizeForMobile() {
                // å‡å°‘ç²’å­æ•°é‡ä»¥æé«˜æ€§èƒ½
                const originalCreateBubbles = window.createBubbles;
                if (originalCreateBubbles) {
                    window.createBubbles = function() {
                        // ç§»åŠ¨ç«¯å‡å°‘æ°”æ³¡æ•°é‡
                        for (let i = 0; i < 2; i++) {
                            const x = Math.random() * window.innerWidth;
                            const y = window.innerHeight + 20;
                            // è¿™é‡Œéœ€è¦è®¿é—®ç²’å­ç³»ç»Ÿçš„å†…éƒ¨å‡½æ•°
                        }
                    };
                }
                
                // é™ä½åŠ¨ç”»é¢‘ç‡
                document.documentElement.style.setProperty('--animation-duration', '0.8s');
                
                console.log('âš¡ ç§»åŠ¨ç«¯æ€§èƒ½ä¼˜åŒ–å·²åº”ç”¨');
            }

            function preventDoubleClickZoom() {
                let lastTouchEnd = 0;
                document.addEventListener('touchend', function(event) {
                    const now = (new Date()).getTime();
                    if (now - lastTouchEnd <= 300) {
                        event.preventDefault();
                    }
                    lastTouchEnd = now;
                }, false);
                
                console.log('ğŸš« åŒå‡»ç¼©æ”¾å·²ç¦ç”¨');
            }

            function initTouchFeedback() {
                // ä¸ºå¯äº¤äº’å…ƒç´ æ·»åŠ è§¦æ‘¸åé¦ˆ
                const interactiveElements = document.querySelectorAll('.balloon, .star, .control-btn, .nav-btn');
                
                interactiveElements.forEach(element => {
                    element.addEventListener('touchstart', function() {
                        this.style.transform = 'scale(1.1)';
                        this.style.transition = 'transform 0.1s ease';
                        
                        // è§¦è§‰åé¦ˆï¼ˆå¦‚æœæ”¯æŒï¼‰
                        if (navigator.vibrate) {
                            navigator.vibrate(50);
                        }
                    }, { passive: true });
                    
                    element.addEventListener('touchend', function() {
                        setTimeout(() => {
                            this.style.transform = '';
                            this.style.transition = '';
                        }, 100);
                    }, { passive: true });
                });
                
                console.log('ğŸ“³ è§¦æ‘¸åé¦ˆå·²åˆå§‹åŒ–');
            }

            // ç§»åŠ¨ç«¯æç¤ºå·²åˆ é™¤ï¼Œé¢„åŠ è½½è§£å†³äº†èµ„æºåŠ è½½é—®é¢˜

            // å¯¼èˆªåŠŸèƒ½å·²ç§»é™¤

            // å»¶è¿Ÿå¯åŠ¨ç¬¬äºŒé˜¶æ®µé¢„åŠ è½½ï¼Œè®©ç”¨æˆ·å…ˆäº«å—å½“å‰é¡µé¢
            setTimeout(() => {
                preloadStageTwo();
            }, 3000); // 3ç§’åå¼€å§‹åå°é¢„åŠ è½½ä¸‹ä¸€é¡µé¢èµ„æº

            console.log('ğŸ‰ è±è±ç”Ÿæ—¥ç¥ç¦é¡µé¢åˆå§‹åŒ–å®Œæˆï¼');
        });
    </script>
</body>
</html> 